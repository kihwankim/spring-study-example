# 1. Hex 아키텍처

## 1.1 정의

# 2. Layer 구조

## 2.1 모듈 종류

1. Domain: 우리가 사용하는 비즈니스 로직 입니다
2. End Point/Main: DI 설정과 Spring 과같은 framework 설정, Rest API, Kafka Consumer 등이 위치한 입력 End point를 의미 합니다
3. Adapter: 세부 사항들의 집합
    - RDB
    - Redis
    - Kafka
    - ...etc

## 2.2 Domain

### 2.2.1 정의

- 우리가 아는 비즈니스 로직이 이뤄진 layer 입니다
- 어떤 외부 설정 사항
    - 트랜젝션, Event Lisnter, Spring Framework 와 같은 세부 사항들이 없는 순수 Java/Kotlin/Paython Code 입니다
    - 어떤 영역도 의존하지 않는게 가장 큰 특징 입니다

### 2.2.2 비즈니스 로직 과 세부사항

- 세부 사항은 언제나 변합니다 하지만 비즈니스 로직은 기획자가 새로운 기획을 내놓지 않는 이상 변하지 않습니다.
- ex) 물건을 산다고 가정하겠습니다
    - 비즈니스 로직
        - 장바구니 정보를 입력 받는다
        - 내 계정 정보를 입력 받는다
        - 장바구니에 있는 정보를 저장 합니다
        - 물품의 잔고량을 검사하고, 만약 주문량보다 잔고량이 더 많을 경우 잔고량을 줄이고 구메 물건을 등록 합니다
        - 운송 시스템에 물건들과 배송지 정보를 전달 합니다
        - 결제를 진행합니다

- 위의 예시는 하나의 비즈니스 로직입니다. 내가 현재 모노리식 아키텍쳐일 경우 모든 작업이 하나의 서버에서 이뤄 지던지, 아니면 운송시스템, 결제 시스템 등으로 나줘져 있어서 rest api를 쓰든지, kafka Event로 비동기 처리를 한다든지..etc
- 우리는 비즈니스 로직을 실행하기 위해서, 요청이 들어오게 되면 위 목록을 실행하는 각각의 API들을 호출하게 됩니다.
- 그리고 나중에 서비스가 잘되서, 하나의 팀이 여러개의 팀으로 분리가 되고, 모놀리식 아키텩처를 여러 서비스로 나누게 된다며 DB 요청이 rest api로 변경되거나, Kafka로 변경되는 경우가 있습니다.
- 위의 DB 요청이 rest api, kafka 로 변경되더라도 중요한 것은 비즈니스 로직은 변경되지 않습니다. 그리고 validation 로직 또한 동일할겁니다.
- 그러므로 우리는 비즈니스 로직은 변경이 잘 이뤄지지 않는다. 안전한 지역 이라고 간주하게 됩니다.
- 반대로 DB, Rest api, Kafka는 언제나 변할 수 있습니다. 서비스 성능을 위해서 rest api 대신 비동기 처리인 Kafka를 쓴다든지, 원래 하나의 DB에서 처리하는 것을 다른 서버로 분리해서 처리한다든지와 같이 불안전하게 계속 변경될 수 있습니다.
- 심지어 어느 조직은 Spring을 사용하다가 Kotar로 프레임워크 변경도 진행하기도 합니다. 우리는 이렇게 변경이 잦고 수정이 다수 이뤄지는 영역을 불안정 지역이라고 명명합니다.
- 만약 Kafka 호출과 rest api 호출과 같이 불안정한 영역을 interface로 정의하여 구현체와 분리하게 된다면, 우리는 세부 사항(구현체)를 편리하게 바꿔 치기 할 수 있습니다. 그러면 비즈니스 로직 수정 없이 세부 사항(구현체)를 바꿀 수 있습니다.
- Hex 아키텍쳐는 위의 내용을 담고 있는 아키텍쳐 입니다
- 우리는 이 아키텍쳐를 흔히 port(interface) adapter(구현체) pattern 이라고도 부르기도 합니다.

### 2.2.3 아키텍쳐 구조 그림

## 2.3 세부 사항

### 2.3.1 세부 사항 변경시 문제가 되는 구조

## 2.4 End Point/Main

### 2.4.1 Main 문

### 2.4.2 EndPoint

### 2.4.3 EndPoint Response 와 Domain 객체(퍼사드 패턴)

# 3 Hex 아키텩처와 접목과 오버 엔지니어링

## 3.1 Hex 아키텍쳐를 도입하면 좋은 케이스

## 3.2 Hex 아키텍쳐를 사용할 경우 오버 엔지이링인 경우